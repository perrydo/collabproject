<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Kawartha Lakes and Haliburton Community Harvesting and Sharing Program</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.png" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    <body>
    <!-- Responsive navbar-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">Virtual GIS Open House 2022 - Project 2220</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" aria-current="page" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="process.html">Process</a></li>
                    <li class="nav-item"><a class="nav-link" href="deliverables.html">Deliverables</a></li>
                </ul>
            </div>
        </div>
    </nav>
        <!-- Header - set the background image for the header in the line below-->
        <header class="py-5 bg-image-full" style="background-image: url('assets/header2.jpg')">
            <div class="text-center my-5 toptext">
                <img class="img-fluid rounded-circle mb-4" src="assets/harvest.jpg" alt="..." />
                <h1 class="text-white fs-3 fw-bolder">Process Steps</h1>
                <p class="text-white mb-0">How we created the solution for this project</p>
            </div>
        </header>
        <!-- Content section-->
        <section class="py-5">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <h2>Objective 1:  Survey123 & Volunteer Sign Up </h2>
                        <!-- <p class="lead">A simple, lightweight, interactive open-source base map</p> -->
                        <p class="mb-2">Two surveys were created using ArcGIS Survey123 connect (Figure 7.2), for fruit tree and vegetable harvest submissions. Both surveys include necessary information questions for assessment and contact by the client to complete the harvest and donation. These surveys are published publicly and open for submissions, with all records received only available to the survey’s private owner.</p>
                        <p class="mb-2">To fulfil the client’s request of mapping each submission, both surveys employed the ‘geopoint’ question type to be plotted on the ArcGIS Online web map in Objective 2. This component was hidden to simplify the user interface and prevent accidental changes made by the user. Users can deny location services should they wish, and it will not affect the ability to submit. This section was set as required in the survey construction and uses the ‘pulldata’ calculation to auto-populate the fields with location permission by the user, ensuring the submission can be properly mapped. The contents were sorted into groups and ordered by least to most important for the user to submit; starting with contact information, to harvest specifications, and ending with images and comments. </p>
                        <p class="mb-2">In the document providing the language to the new website (Objective 4), the client expressed their desire to recruit volunteer gleaners / pickers / harvesters for the program. To address this, a Google Form survey was created. </p>
                    </div>
                </div>
            </div>
        </section>
        <!-- Image element - set the background image for the header in the line below-->
        <div class="py-5 bg-image-full" style="background-image: url('assets/survey123.png')">
            <!-- Put anything you want here! The spacer below with inline CSS is just for demo purposes!-->
            <div style="height: 20rem"></div>
        </div>
        <!-- Content section-->
        <section class="py-5">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <h2>Objective 2: ArcGIS Online Web Maps</h2>
                        <!-- <p class="lead">A simple survey form to collect significant tree data</p> -->
                        <p class="mb-2">An ArcGIS Web Map was created to visualise the location of submissions. This allows the client to roughly view the location of produce and coordinate volunteer harvesters and determine the best location for the donation more efficiently. This map will remain private with one owner or group on AGOL, to ensure the security of the data submitted by the landowners.</p>
                        <p class="mb-2">Each survey required the creation of a ‘layer view’ to plot on the web map, due to the nature of public versus private permissions in AGOL, with region boundaries and the Treaty 20 boundary added at the request of the client. Both survey layers are set to automatically refresh every minute. Appropriate symbology was chosen for accessibility of view, dark base map with contrasting coloured and unique shaped markers.</p>
                        <p class="mb-2">As this map will be viewed and maintained by a non-GIS professional, which may shift between multiple individuals over time, an AGOL & Survey123 Maintenance Guide was created and provided to the client to safeguard successful long term operation. </p>
                        <p class="mb-2">An additional web map was created to embed in the new website of Objective 4, to highlight local food source agencies. This map includes the regions and Treaty20 boundaries.</p>
                    </div>
                </div>
            </div>
        </section>
        <div class="py-5 bg-image-full" style="background-image: url('assets/agolmap.png')">
            <!-- Put anything you want here! The spacer below with inline CSS is just for demo purposes!-->
            <div style="height: 20rem"></div>
        </div>
        <!-- Content section-->
        <section class="py-5">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <h2>How did Bourne send data to those who need it?</h2>
                        <p class="lead">JSON</p>
                        <p class="mb-2">In order for the tree data from the survey to be added to the map, it has to be exported in geoJSON format and added to the map. Data from the survey is stored in the Humanitarian Server hosted by UN Office for the Coordination of Humanitarian Affairs (OCHA) and can be accessed through a GET request via KoBo Toolbox API.</p>
                        <p class="mb-2">The geoJSON was then downloaded and added to the map via JavaScript. We also set a pop-up for each marker, showing the species name, photo and any comment if available – all pulled directly from the geoJSON file. In addition to the data collected from the survey, data collected by students of GEOM65, Fleming College in the fall semester of 2021 was also added to the map using a separate geoJSON file. All the tree markers were put into either a deciduous or coniferous layer to enable users to filter the results. Each layer is distinguished by a different marker colour, and the data points collected by Fleming College students also have different colours comparing to the markers from the survey. </p>
                    </div>
                </div>
            </div>
        </section>
        <div class="py-5 bg-image-full" style="background-image: url('assets/markers.png')">
            <!-- Put anything you want here! The spacer below with inline CSS is just for demo purposes!-->
            <div style="height: 20rem"></div>
        </div>
        <!-- Content section-->
        <section class="py-5">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <h2>The Joy Of Automation</h2>
                        <p class="lead">Finishing touches to keep the map running properly</p>
                        <p class="mb-2">So far, the process of adding the geoJSON file from KoBo Toolbox to the map had been done manually. In order to automate the project, we had to set up a way for the geoJSON to be updated automatically by github. Using the API token from the Humanitarian Response account used to create the survey, as well as the python codes for a GET command to pull the geoJSON file from KoBo Toolbox generated by postman.com, we started setting up the python file that would be run by github to update the local geoJSON file. </p>
                        <p class="mb-2">The GET command in the python file pulls all the data from KoBo Toolbox down into a local geoJSON file. However, as the project focuses on significant Ontario native trees, we added a geoJSON file of the boundaries of Ontario and coded a filter to eliminate any input from the submission form that is outside of the province. The output is then be put into a new geoJSON file, and this is the file that is coded into the web map.</p>
                        <p class="mb-2">After verifying that the python codes run properly on Visual Studio Code, we set a github workflow that would automatically run the python file in the repository. A yml file was created, setting up the process to be run every 5 minutes. Now that everything has been automated, the project is finished and ready for a large audience to experience.</p>
                    </div>
                </div>
            </div>
        </section>
        <div class="py-5 bg-image-full" style="background-image: url('assets/githubflow.jpg')">
            <!-- Put anything you want here! The spacer below with inline CSS is just for demo purposes!-->
            <div style="height: 20rem"></div>
        </div>
        <!-- Content section-->
        <section class="py-5">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <h2>Trial And Error </h2>
                        <p class="lead">The struggle is real</p>
                        <p class="mb-2">One of the first problems we encountered was the images pulled from KoBo Toolbox were broken in the pop-ups. After many trials of adding data, deleting data, making different surveys, we found that only the photos from the first survey that we created during our test run could be displayed. This is most likely a glitch from the server side of KoBo Toolbox, and to solve this problem, we had to update what originally was a test survey into our official survey.</p>
                        <p class="mb-2">Another problem relating to the images was also discovered. Due to the massive amount of repetitive JavaScript, our original plan was to put all the JS codes into a separate JS file and reference the script in the html file. However, when the JS was in an external file,  the images became broken again. Therefore, we had to put all the JS codes back into the html file. Luckily, the JS script to add the data from Fleming College students ran perfectly fine in the external file – probably because there was no image to pull from an online database server.</p>
                        <p class="mb-2">The biggest problem that plagued our project was trying to have the yml run properly. Initially, the file kept failing to run properly. We could not find any thing wrong with our syntax for the longest time. After finding out that we could see what the error was if we clicked into the notification (pictured), we discovered that the problem lied in the requirements.txt file that was used to list all the package. It took many trials – which actually took a very long time due to github server being very slow during the day, by the elimination process, we found out that the json module needs to put input as jsonschema in the txt file in order for it to run.</p>
                        <img src="assets/failedgeojson.png" alt="failed attempts" style="max-width:100%;height:auto;">
                        <img src="assets/error.png" alt="error message" style="max-width:100%;height:auto;">
                        <img src="assets/successgeojson.png" alt="successful attempts" style="max-width:100%;height:auto;">
                    </div>
                </div>
            </div>
        </section>
        <!-- Footer-->
        <footer class="py-5 bg-dark">
            <div class="container"><p class="m-0 text-center text-white">&copy; PRISM Collab Project 2022</p></div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
